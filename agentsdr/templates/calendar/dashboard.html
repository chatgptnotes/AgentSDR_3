{% extends "base.html" %}

{% block title %}Calendar Dashboard - AgentSDR{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="flex justify-between items-center mb-8">
            <div>
                <h1 class="text-4xl font-bold text-white mb-2">ğŸ“… Calendar Dashboard</h1>
                <p class="text-white/80">Manage your Google Calendar integration</p>
            </div>
            <div class="flex space-x-4">
                <a href="{{ url_for('calendar.disconnect_calendar') }}" 
                   class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition-colors duration-200"
                   onclick="return confirm('Are you sure you want to disconnect your calendar?')">
                    ğŸ”Œ Disconnect Calendar
                </a>
                <a href="{{ url_for('orgs.manage_org') }}" 
                   class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg transition-colors duration-200">
                    â† Back to Organization
                </a>
            </div>
        </div>

        <!-- Calendar Status -->
        <div class="bg-white/10 backdrop-blur-md rounded-2xl p-6 mb-8 border border-white/20">
            <div class="flex items-center space-x-4">
                <div class="w-12 h-12 bg-green-500 rounded-full flex items-center justify-center">
                    <span class="text-2xl">âœ…</span>
                </div>
                <div>
                    <h3 class="text-xl font-semibold text-white">Google Calendar Connected</h3>
                    <p class="text-white/80">Your calendar is successfully connected and syncing</p>
                </div>
            </div>
        </div>

        <!-- Upcoming Events -->
        <div class="bg-white/10 backdrop-blur-md rounded-2xl p-6 border border-white/20">
            <h2 class="text-2xl font-bold text-white mb-6">ğŸ“‹ Upcoming Events (Next 7 Days)</h2>
            
            {% if events %}
                <div class="space-y-4">
                    {% for event in events %}
                        <div class="bg-white/5 rounded-xl p-4 border border-white/10 hover:bg-white/10 transition-colors duration-200">
                            <div class="flex justify-between items-start">
                                <div class="flex-1">
                                    <h3 class="text-lg font-semibold text-white mb-2">
                                        {{ event.summary }}
                                    </h3>
                                    
                                    {% if event.description %}
                                        <p class="text-white/70 mb-2">{{ event.description[:100] }}{% if event.description|length > 100 %}...{% endif %}</p>
                                    {% endif %}
                                    
                                    <div class="flex flex-wrap gap-4 text-sm text-white/60">
                                        <div class="flex items-center space-x-1">
                                            <span>ğŸ•’</span>
                                            <span>{{ event.start }}</span>
                                        </div>
                                        
                                        {% if event.location %}
                                            <div class="flex items-center space-x-1">
                                                <span>ğŸ“</span>
                                                <span>{{ event.location }}</span>
                                            </div>
                                        {% endif %}
                                        
                                        {% if event.attendees %}
                                            <div class="flex items-center space-x-1">
                                                <span>ğŸ‘¥</span>
                                                <span>{{ event.attendees|length }} attendees</span>
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                                
                                <div class="ml-4">
                                    <button class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded-lg text-sm transition-colors duration-200"
                                            onclick="createAgent('{{ event.id }}', '{{ event.summary }}')">
                                        ğŸ¤– Create Agent
                                    </button>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="text-center py-12">
                    <div class="text-6xl mb-4">ğŸ“…</div>
                    <h3 class="text-xl font-semibold text-white mb-2">No Upcoming Events</h3>
                    <p class="text-white/70">You don't have any events in the next 7 days</p>
                </div>
            {% endif %}
        </div>

        <!-- Calendar Agent Options -->
        <div class="mt-8 bg-white/10 backdrop-blur-md rounded-2xl p-6 border border-white/20">
            <h2 class="text-2xl font-bold text-white mb-6">ğŸ¤– Calendar Agent Options</h2>
            
            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Meeting Summarizer Agent -->
                <div class="bg-white/5 rounded-xl p-6 border border-white/10 hover:bg-white/10 transition-colors duration-200">
                    <div class="text-4xl mb-4">ğŸ“</div>
                    <h3 class="text-lg font-semibold text-white mb-2">Meeting Summarizer</h3>
                    <p class="text-white/70 mb-4">Automatically summarize meeting notes and action items</p>
                    <button class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg w-full transition-colors duration-200"
                            onclick="createCalendarAgent('meeting_summarizer')">
                        Create Agent
                    </button>
                </div>

                <!-- Schedule Optimizer Agent -->
                <div class="bg-white/5 rounded-xl p-6 border border-white/10 hover:bg-white/10 transition-colors duration-200">
                    <div class="text-4xl mb-4">âš¡</div>
                    <h3 class="text-lg font-semibold text-white mb-2">Schedule Optimizer</h3>
                    <p class="text-white/70 mb-4">Analyze your schedule and suggest optimizations</p>
                    <button class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg w-full transition-colors duration-200"
                            onclick="createCalendarAgent('schedule_optimizer')">
                        Create Agent
                    </button>
                </div>

                <!-- Event Reminder Agent -->
                <div class="bg-white/5 rounded-xl p-6 border border-white/10 hover:bg-white/10 transition-colors duration-200">
                    <div class="text-4xl mb-4">â°</div>
                    <h3 class="text-lg font-semibold text-white mb-2">Smart Reminders</h3>
                    <p class="text-white/70 mb-4">Send intelligent reminders and prep notes</p>
                    <button class="bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-lg w-full transition-colors duration-200"
                            onclick="createCalendarAgent('smart_reminders')">
                        Create Agent
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function createAgent(eventId, eventTitle) {
    // Redirect to agent creation with calendar context
    const params = new URLSearchParams({
        type: 'calendar_event',
        event_id: eventId,
        event_title: eventTitle
    });
    window.location.href = `/orgs/agents/create?${params.toString()}`;
}

function createCalendarAgent(agentType) {
    // Redirect to agent creation with calendar agent type
    const params = new URLSearchParams({
        type: 'calendar',
        agent_type: agentType
    });
    window.location.href = `/orgs/agents/create?${params.toString()}`;
}

// Auto-refresh events every 5 minutes
setInterval(function() {
    fetch('/calendar/events')
        .then(response => response.json())
        .then(data => {
            if (data.events) {
                // Update the events display
                console.log('Events refreshed:', data.events.length);
            }
        })
        .catch(error => console.error('Error refreshing events:', error));
}, 5 * 60 * 1000);
</script>
{% endblock %}
