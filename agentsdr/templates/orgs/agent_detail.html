{% extends "layout.html" %}

{% block title %}{{ agent.name }} - {{ organization.name }}{% endblock %}

{% block content %}
<div class="space-y-8" x-data="{
    fetchingEmails: false,
    testing: false,
    fetchCriteria: 'last_24_hours',
    customCount: 10,
    error: null,
    // Patient management state
    selectedPatientId: null,
    patientNotes: '',
    generating: false,
    fetchAndSummarizeEmails() {
        this.fetchingEmails = true;
        this.error = null;

        const criteria = {
            type: this.fetchCriteria,
            count: this.customCount
        };

        fetch(`/orgs/{{ organization.slug }}/agents/{{ agent.id }}/emails/summarize`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(criteria)
        })
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }
            return response.json();
        })
        .then(data => {
            if (data.error) {
                this.error = data.error;
            } else if (data.redirect_url) {
                showToast(`Found ${data.count} emails. Redirecting to summaries...`, 'success');
                setTimeout(() => {
                    window.location.href = data.redirect_url;
                }, 1000);
            }
        })
        .catch(error => {
            this.error = `Failed to fetch and summarize emails: ${error.message}`;
        })
        .finally(() => {
            this.fetchingEmails = false;
        });
    },
    testConnection() {
        this.testing = true;
        this.error = null;
        fetch(`/orgs/{{ organization.slug }}/agents/{{ agent.id }}/emails/test`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' }
        })
        .then(r => { if (!r.ok) throw new Error(`HTTP ${r.status}`); return r.json(); })
        .then(data => {
            if (data.success) {
                showToast(`âœ“ Gmail connection working! Email: ${data.email}, Total messages: ${data.total_messages}`, 'success');
            } else {
                this.error = data.error || 'Connection test failed';
            }
        })
        .catch(err => { this.error = `Connection test failed: ${err.message}`; })
        .finally(() => { this.testing = false; });
    },
    generatePatientReport() {
        this.generating = true; this.error = null;
        fetch(`/orgs/{{ organization.slug }}/agents/{{ agent.id }}/patient/report`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ patient_id: this.selectedPatientId, notes: this.patientNotes })
        })
        .then(r => { if (!r.ok) throw new Error(`HTTP ${r.status}`); return r.json(); })
        .then(data => {
            if (data.success) {
                alert('Patient report generated successfully!');
            } else {
                this.error = data.error || 'Failed to generate patient report';
            }
        })
        .catch(err => { this.error = `Failed to generate patient report: ${err.message}`; })
        .finally(() => { this.generating = false; });
    }
}">
    <!-- Enhanced Header -->
    <div class="card-gradient rounded-xl shadow-lg overflow-hidden">
        <div class="px-8 py-8 relative">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="w-16 h-16 bg-white/20 rounded-full flex items-center justify-center backdrop-blur-sm">
                        <span class="text-3xl">
                            {% if agent.agent_type == 'email_summarizer' %}ğŸ“§
                            {% elif agent.agent_type == 'hubspot_data' %}ğŸ”—
                            {% elif agent.agent_type == 'calendar' %}ğŸ“…
                            {% else %}ğŸ¤–{% endif %}
                        </span>
                    </div>
                    <div>
                        <h1 class="text-3xl font-bold text-white">{{ agent.name }}</h1>
                        <p class="text-white/80 text-lg">{{ agent.agent_type.replace('_', ' ').title() }}</p>
                    </div>
                </div>
                <div class="flex space-x-3">
                    <a href="{{ url_for('orgs.list_agents', org_slug=organization.slug) }}" 
                       class="btn-gradient py-3 px-6 rounded-xl font-semibold transition-all duration-300 hover:scale-105">
                        â† Back to Agents
                    </a>
                </div>
            </div>
            <div class="absolute top-4 right-4 text-white/10 text-6xl float-up">âš¡</div>
        </div>
    </div>

    {% if agent.agent_type == 'email_summarizer' %}
    <!-- Email Summarizer Interface -->
    <div class="bg-white rounded-xl shadow-lg p-8">
        <div class="flex items-center space-x-3 mb-6">
            <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center">
                <span class="text-white text-lg">ğŸ“§</span>
            </div>
            <h3 class="text-2xl font-bold text-gray-900">Email Summarizer</h3>
        </div>

        {% if not gmail_connected %}
        <!-- Gmail Connection Required -->
        <div class="text-center py-12">
            <div class="w-20 h-20 bg-gradient-to-br from-red-500 to-pink-600 rounded-full flex items-center justify-center mx-auto mb-6">
                <span class="text-3xl text-white">ğŸ“§</span>
            </div>
            <h3 class="text-xl font-bold text-gray-900 mb-4">Gmail Connection Required</h3>
            <p class="text-gray-600 mb-8 max-w-md mx-auto">
                To start summarizing emails, you need to connect your Gmail account. This will allow the agent to access and summarize your emails.
            </p>
            <button onclick="connectGmail('{{ organization.slug }}', '{{ agent.id }}')" 
                    class="btn-gradient inline-flex items-center py-4 px-8 rounded-xl font-semibold text-lg transition-all duration-300 hover:scale-105 pulse-glow">
                ğŸ”— Connect Gmail Account
            </button>
        </div>
        {% else %}
        <!-- Gmail Connected - Email Fetching Options -->
        <div class="space-y-6">
            <div class="flex items-center justify-between p-4 bg-green-50 rounded-lg border border-green-200">
                <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center">
                        <span class="text-white text-sm">âœ“</span>
                    </div>
                    <div>
                        <h4 class="font-semibold text-green-800">Gmail Connected</h4>
                        <p class="text-green-600 text-sm">Your Gmail account is connected and ready to use.</p>
                    </div>
                </div>
                <button @click="testConnection()" 
                        :disabled="testing"
                        class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 text-sm">
                    <span x-show="!testing">Test Connection</span>
                    <span x-show="testing">Testing...</span>
                </button>
            </div>

            <!-- Email Fetching Options -->
            <div>
                <h4 class="text-lg font-semibold text-gray-900 mb-4">Choose Email Criteria</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 reveal-list">
                    <button type="button" 
                            :class="fetchCriteria === 'last_24_hours' ? 'border-blue-500 bg-blue-50' : 'border-gray-300'"
                            @click="fetchCriteria = 'last_24_hours'"
                            class="border-2 rounded-lg p-4 text-left hover:border-blue-400 transition-colors">
                        <div class="font-medium text-gray-900">Last 24 Hours</div>
                        <div class="text-sm text-gray-600">Get emails from the past day</div>
                    </button>
                    
                    <button type="button" 
                            :class="fetchCriteria === 'last_7_days' ? 'border-blue-500 bg-blue-50' : 'border-gray-300'"
                            @click="fetchCriteria = 'last_7_days'"
                            class="border-2 rounded-lg p-4 text-left hover:border-blue-400 transition-colors">
                        <div class="font-medium text-gray-900">Last 7 Days</div>
                        <div class="text-sm text-gray-600">Get emails from the past week</div>
                    </button>
                    
                    <button type="button" 
                            :class="fetchCriteria === 'latest_n' ? 'border-blue-500 bg-blue-50' : 'border-gray-300'"
                            @click="fetchCriteria = 'latest_n'"
                            class="border-2 rounded-lg p-4 text-left hover:border-blue-400 transition-colors">
                        <div class="font-medium text-gray-900">Latest N Emails</div>
                        <div class="text-sm text-gray-600">Get the most recent emails</div>
                        <div x-show="fetchCriteria === 'latest_n'" class="mt-2">
                            <input type="number" x-model.number="customCount" min="1" max="100" 
                                   class="w-20 px-2 py-1 border border-gray-300 rounded text-sm">
                            <span class="text-sm text-gray-600 ml-1">emails</span>
                        </div>
                    </button>
                    
                    <button type="button" 
                            :class="fetchCriteria === 'oldest_n' ? 'border-blue-500 bg-blue-50' : 'border-gray-300'"
                            @click="fetchCriteria = 'oldest_n'"
                            class="border-2 rounded-lg p-4 text-left hover:border-blue-400 transition-colors">
                        <div class="font-medium text-gray-900">Oldest N Emails</div>
                        <div class="text-sm text-gray-600">Get the oldest unread emails</div>
                        <div x-show="fetchCriteria === 'oldest_n'" class="mt-2">
                            <input type="number" x-model.number="customCount" min="1" max="100" 
                                   class="w-20 px-2 py-1 border border-gray-300 rounded text-sm">
                            <span class="text-sm text-gray-600 ml-1">emails</span>
                        </div>
                    </button>
                </div>
            </div>

            <!-- Fetch Button -->
            <div class="text-center">
                <button @click="fetchAndSummarizeEmails()" 
                        :disabled="fetchingEmails"
                        class="btn-gradient inline-flex items-center py-4 px-8 rounded-xl font-semibold text-lg transition-all duration-300 hover:scale-105"
                        :class="{ 'opacity-50 cursor-not-allowed': fetchingEmails }">
                    <span x-show="!fetchingEmails">ğŸ“§ Fetch & Summarize Emails</span>
                    <span x-show="fetchingEmails" class="flex items-center">
                        <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        Processing...
                    </span>
                </button>
            </div>

            <!-- Error Display -->
            <div x-show="error" class="p-4 bg-red-50 border border-red-200 rounded-lg">
                <div class="flex items-center">
                    <span class="text-red-500 mr-2">âŒ</span>
                    <span class="text-red-700" x-text="error"></span>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
    {% elif agent.agent_type == 'hubspot_data' %}
    <!-- HubSpot Proposal Drafting UI -->
    <div class="bg-white rounded-xl shadow-lg p-8">
        <div class="flex items-center space-x-3 mb-6">
            <div class="w-10 h-10 bg-gradient-to-br from-amber-500 to-pink-600 rounded-lg flex items-center justify-center">
                <span class="text-white text-lg">ğŸ”—</span>
            </div>
            <h3 class="text-2xl font-bold text-gray-900">Proposal Drafting (HubSpot)</h3>
        </div>

        {% if not hubspot_connected %}
        <div class="text-center py-12">
            <div class="w-20 h-20 bg-gradient-to-br from-amber-500 to-pink-600 rounded-full flex items-center justify-center mx-auto mb-6">
                <span class="text-3xl text-white">ğŸ”—</span>
            </div>
            <h3 class="text-xl font-bold text-gray-900 mb-4">Connect HubSpot</h3>
            <p class="text-gray-600 mb-8 max-w-md mx-auto">
                Connect to HubSpot to fetch recent CRM data (contacts, companies, deals) and auto-fill a proposal draft.
            </p>
            <a href="{{ url_for('orgs.hubspot_auth', org_slug=organization.slug, agent_id=agent.id) }}"
               class="btn-gradient inline-flex items-center py-4 px-8 rounded-xl font-semibold text-lg transition-all duration-300 hover:scale-105 pulse-glow">
                ğŸ”— Connect HubSpot
            </a>
        </div>
        {% else %}
        <div class="space-y-6">
            <div class="flex items-center justify-between p-4 bg-green-50 rounded-lg border border-green-200">
                <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center">
                        <span class="text-white text-sm">âœ“</span>
                    </div>
                    <div>
                        <h4 class="font-semibold text-green-800">HubSpot Connected</h4>
                        <p class="text-green-600 text-sm">Your HubSpot account is connected and ready.</p>
                    </div>
                </div>
            </div>

            <!-- Patient Management Section -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6" x-data="{
                patients: [],
                loadingPatients: false,
                patientsError: null,
                selectedPatient: null,
                showPatientDetails: false,

                async init() {
                    await this.loadPatients();
                },

                async loadPatients() {
                    this.loadingPatients = true;
                    this.patientsError = null;

                    try {
                        const response = await fetch(`/orgs/{{ organization.slug }}/agents/{{ agent.id }}/hubspot/patients`);
                        const data = await response.json();

                        if (data.success) {
                            this.patients = data.patients;
                        } else {
                            this.patientsError = data.error || 'Failed to load patients';
                        }
                    } catch (error) {
                        this.patientsError = `Failed to load patients: ${error.message}`;
                    } finally {
                        this.loadingPatients = false;
                    }
                },
                makeCall(phoneNumber, patientName) {
                    if (phoneNumber) {
                        if (confirm(`Call ${patientName} at ${phoneNumber}?`)) {
                            window.open(`tel:${phoneNumber}`, '_self');
                        }
                    } else {
                        alert('No phone number available for this patient');
                    }
                },
                selectPatient(patient) {
                    this.selectedPatient = patient;
                    this.showPatientDetails = true;
                },
                getStatusColor(status) {
                    switch(status) {
                        case 'stable': return 'bg-green-100 text-green-800';
                        case 'recovering': return 'bg-blue-100 text-blue-800';
                        case 'improving': return 'bg-purple-100 text-purple-800';
                        case 'recent': return 'bg-emerald-100 text-emerald-800';
                        case 'overdue': return 'bg-red-100 text-red-800';
                        default: return 'bg-gray-100 text-gray-800';
                    }
                }
            }">
                <div class="flex items-center justify-between mb-6">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-gradient-to-br from-green-500 to-blue-600 rounded-lg flex items-center justify-center">
                            <span class="text-white text-lg">ğŸ¥</span>
                        </div>
                        <div>
                            <h3 class="text-2xl font-bold text-gray-900">Patient Management</h3>
                            <p class="text-gray-600">Monitor patient status and updates</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2">
                        <span class="text-sm text-gray-500">Total Patients:</span>
                        <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-sm font-medium" x-text="patients.length"></span>
                    </div>
                </div>

                <!-- Loading State -->
                <div x-show="loadingPatients" class="text-center py-8">
                    <div class="inline-flex items-center space-x-2">
                        <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"></div>
                        <span class="text-gray-600">Loading patients from HubSpot...</span>
                    </div>
                </div>

                <!-- Error State -->
                <div x-show="patientsError" class="bg-red-50 border border-red-200 rounded-lg p-4 mb-4">
                    <div class="flex items-center space-x-2">
                        <span class="text-red-500">âš ï¸</span>
                        <span class="text-red-700" x-text="patientsError"></span>
                    </div>
                    <button @click="loadPatients()" class="mt-2 text-sm text-red-600 hover:text-red-800 underline">
                        Try Again
                    </button>
                </div>

                <!-- Empty State -->
                <div x-show="!loadingPatients && !patientsError && patients.length === 0" class="text-center py-8">
                    <div class="text-gray-500">
                        <span class="text-4xl">ğŸ¥</span>
                        <p class="mt-2">No patients found in HubSpot</p>
                        <p class="text-sm">Make sure your HubSpot contacts have the required fields</p>
                    </div>
                </div>

                <!-- Patients Grid -->
                <div x-show="!loadingPatients && !patientsError && patients.length > 0" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <template x-for="patient in patients" :key="patient.id">
                        <div class="bg-gray-50 rounded-lg border border-gray-200 p-4 hover:shadow-md transition-shadow duration-200">
                            <div class="flex items-start justify-between mb-3">
                                <div class="flex-1">
                                    <h5 class="font-semibold text-gray-900 text-lg" x-text="patient.name"></h5>
                                    <div class="flex items-center space-x-2 mt-1">
                                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium"
                                              :class="getStatusColor(patient.status)"
                                              x-text="patient.status.charAt(0).toUpperCase() + patient.status.slice(1)"></span>
                                    </div>
                                </div>
                                <div class="w-10 h-10 bg-gradient-to-br from-green-400 to-blue-500 rounded-full flex items-center justify-center">
                                    <span class="text-white text-sm">ğŸ‘¤</span>
                                </div>
                            </div>

                            <div class="space-y-2 mb-4">
                                <div class="flex items-center space-x-2">
                                    <span class="text-gray-500 text-sm">ğŸ“</span>
                                    <span class="text-sm text-gray-700" x-text="patient.phone"></span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <span class="text-gray-500 text-sm">ğŸ“…</span>
                                    <span class="text-sm text-gray-700">Last: <span x-text="patient.checkUpdate"></span></span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <span class="text-gray-500 text-sm">ğŸ“‹</span>
                                    <span class="text-sm text-gray-700 line-clamp-2" x-text="patient.summary.substring(0, 50) + '...'"></span>
                                </div>
                            </div>

                            <div class="flex space-x-2">
                                <button @click="makeCall(patient.phone, patient.name)"
                                        class="flex-1 bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded-lg text-sm font-medium transition-colors duration-200 flex items-center justify-center space-x-1">
                                    <span>ğŸ“</span>
                                    <span>Call</span>
                                </button>
                                <button @click="selectPatient(patient)"
                                        class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded-lg text-sm font-medium transition-colors duration-200 flex items-center justify-center space-x-1">
                                    <span>ğŸ‘ï¸</span>
                                    <span>View</span>
                                </button>
                            </div>
                        </div>
                    </template>
                </div>

                <!-- Patient Details Modal -->
                <div x-show="showPatientDetails"
                     x-transition:enter="transition ease-out duration-300"
                     x-transition:enter-start="opacity-0"
                     x-transition:enter-end="opacity-100"
                     x-transition:leave="transition ease-in duration-200"
                     x-transition:leave-start="opacity-100"
                     x-transition:leave-end="opacity-0"
                     class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
                     @click="showPatientDetails = false">
                    <div class="bg-white rounded-xl p-6 max-w-lg w-full mx-4" @click.stop>
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-xl font-bold text-gray-900">Patient Details</h3>
                            <button @click="showPatientDetails = false" class="text-gray-500 hover:text-gray-700">
                                <span class="text-xl">âœ•</span>
                            </button>
                        </div>

                        <template x-if="selectedPatient">
                            <div class="space-y-4">
                                <div class="text-center mb-4">
                                    <div class="w-16 h-16 bg-gradient-to-br from-green-400 to-blue-500 rounded-full flex items-center justify-center mx-auto mb-2">
                                        <span class="text-white text-2xl">ğŸ‘¤</span>
                                    </div>
                                    <h4 class="text-lg font-semibold" x-text="selectedPatient?.name"></h4>
                                    <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium mt-1"
                                          :class="getStatusColor(selectedPatient?.status)"
                                          x-text="selectedPatient?.status?.charAt(0).toUpperCase() + selectedPatient?.status?.slice(1)"></span>
                                </div>

                                <div class="space-y-3">
                                    <div class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg">
                                        <span class="text-gray-500">ğŸ“</span>
                                        <div>
                                            <p class="text-sm text-gray-600">Phone</p>
                                            <p class="font-medium" x-text="selectedPatient?.phone"></p>
                                        </div>
                                    </div>

                                    <div class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg">
                                        <span class="text-gray-500">ğŸ“…</span>
                                        <div>
                                            <p class="text-sm text-gray-600">Last Check Update</p>
                                            <p class="font-medium" x-text="selectedPatient?.checkUpdate"></p>
                                        </div>
                                    </div>

                                    <div class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg">
                                        <span class="text-gray-500">ğŸ“…</span>
                                        <div>
                                            <p class="text-sm text-gray-600">Next Appointment</p>
                                            <p class="font-medium" x-text="selectedPatient?.nextAppointment"></p>
                                        </div>
                                    </div>

                                    <div class="p-3 bg-gray-50 rounded-lg">
                                        <div class="flex items-start space-x-3">
                                            <span class="text-gray-500 mt-1">ğŸ“‹</span>
                                            <div class="flex-1">
                                                <p class="text-sm text-gray-600 mb-1">Summary</p>
                                                <p class="text-sm text-gray-800" x-text="selectedPatient?.summary"></p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="flex space-x-3 mt-6">
                                    <button @click="makeCall(selectedPatient?.phone, selectedPatient?.name)"
                                            class="flex-1 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors duration-200 flex items-center justify-center space-x-2">
                                        <span>ğŸ“</span>
                                        <span>Call Patient</span>
                                    </button>
                                    <button @click="showPatientDetails = false"
                                            class="flex-1 bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-medium transition-colors duration-200">
                                        Close
                                    </button>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
            </div>

            <div x-show="error" class="p-4 bg-red-50 border border-red-200 rounded-lg">
                <div class="flex items-center">
                    <span class="text-red-500 mr-2">âŒ</span>
                    <span class="text-red-700" x-text="error"></span>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
    {% elif agent.agent_type == 'calendar' %}
    <!-- Calendar Agent -->
    <div class="bg-white rounded-xl shadow-lg p-8">
        <div class="text-center mb-8">
            <div class="w-20 h-20 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-6">
                <span class="text-4xl text-white">ğŸ“…</span>
            </div>
            <h3 class="text-2xl font-bold text-gray-900 mb-4">Calendar Agent</h3>
            <p class="text-gray-600 text-lg mb-8">
                Connect your Google Calendar to analyze events, schedule optimization, and smart reminders.
            </p>
        </div>

        <!-- Calendar Connection Status -->
        <div class="mb-8">
            <div class="bg-gray-50 rounded-lg p-6">
                <h4 class="text-lg font-semibold text-gray-900 mb-4">ğŸ“Š Calendar Connection</h4>
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <div class="w-3 h-3 bg-red-500 rounded-full"></div>
                        <span class="text-gray-700">Google Calendar: Not Connected</span>
                    </div>
                    <a href="{{ url_for('calendar.connect_calendar') }}"
                       class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors duration-200">
                        ğŸ”— Connect Calendar
                    </a>
                </div>
                <p class="text-sm text-gray-500 mt-2">
                    Connect your Google Calendar to enable calendar analysis and automation features.
                </p>
            </div>
        </div>

        <!-- Calendar Features -->
        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
            <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg p-6 border border-blue-200">
                <div class="text-3xl mb-4">ğŸ“</div>
                <h4 class="text-lg font-semibold text-gray-900 mb-2">Meeting Summarizer</h4>
                <p class="text-gray-600 mb-4">Automatically summarize meeting notes and extract action items.</p>
                <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg w-full transition-colors duration-200">
                    Configure
                </button>
            </div>

            <div class="bg-gradient-to-br from-green-50 to-green-100 rounded-lg p-6 border border-green-200">
                <div class="text-3xl mb-4">âš¡</div>
                <h4 class="text-lg font-semibold text-gray-900 mb-2">Schedule Optimizer</h4>
                <p class="text-gray-600 mb-4">Analyze your schedule and suggest time management improvements.</p>
                <button class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg w-full transition-colors duration-200">
                    Configure
                </button>
            </div>

            <div class="bg-gradient-to-br from-orange-50 to-orange-100 rounded-lg p-6 border border-orange-200">
                <div class="text-3xl mb-4">â°</div>
                <h4 class="text-lg font-semibold text-gray-900 mb-2">Smart Reminders</h4>
                <p class="text-gray-600 mb-4">Send intelligent reminders with meeting prep and context.</p>
                <button class="bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-lg w-full transition-colors duration-200">
                    Configure
                </button>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="mt-8 bg-gray-50 rounded-lg p-6">
            <h4 class="text-lg font-semibold text-gray-900 mb-4">ğŸš€ Quick Actions</h4>
            <div class="flex flex-wrap gap-3">
                <a href="{{ url_for('calendar.calendar_dashboard') }}"
                   class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition-colors duration-200">
                    ğŸ“… View Calendar Dashboard
                </a>
                <button class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg transition-colors duration-200">
                    ğŸ“Š Generate Schedule Report
                </button>
                <button class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg transition-colors duration-200">
                    ğŸ” Analyze Meeting Patterns
                </button>
            </div>
        </div>
    </div>
    {% else %}
    <!-- Other Agent Types -->
    <div class="bg-white rounded-xl shadow-lg p-8 text-center">
        <div class="w-20 h-20 bg-gradient-to-br from-gray-400 to-gray-600 rounded-full flex items-center justify-center mx-auto mb-6">
            <span class="text-4xl text-white">ğŸ¤–</span>
        </div>
        <h3 class="text-2xl font-bold text-gray-900 mb-4">{{ agent.agent_type.replace('_', ' ').title() }}</h3>
        <p class="text-gray-600 text-lg mb-8">
            This agent type is not yet implemented. Coming soon!
        </p>
    </div>
    {% endif %}
</div>

<script>
async function connectGmail(orgSlug, agentId) {
    try {
        window.location.href = `/orgs/${orgSlug}/agents/${agentId}/gmail/auth`;
    } catch (error) {
        alert('Failed to connect Gmail. Please try again.');
    }
}
</script>
{% endblock %}
